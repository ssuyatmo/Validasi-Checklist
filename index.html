<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QA Inspection Komatsu HD785-7</title>
<style>
  body {
    font-family: "Segoe UI", sans-serif;
    background: linear-gradient(to bottom right,#fef9e7,#d4efdf);
    margin:0;padding:10px;
  }
  .header {
    background: linear-gradient(90deg,#d4af37,#9acd32);
    color:#222;text-align:center;
    padding:10px;border-radius:10px;
    box-shadow:0 2px 5px rgba(0,0,0,.2);
    font-weight:bold;
  }
  .card {
    background:#fff;margin:10px 0;padding:10px;
    border-radius:10px;
    box-shadow:0 2px 6px rgba(0,0,0,.15);
  }
  .section-title {font-weight:bold;margin-top:5px;color:#2e7d32;}
  label {display:block;margin:4px 0;}
  input[type="text"],input[type="number"],textarea,select{
    width:100%;padding:5px;border:1px solid #ccc;border-radius:5px;
  }
  .item-row{display:flex;justify-content:space-between;align-items:center;margin:4px 0;}
  .btn{
    border:none;border-radius:6px;padding:5px 10px;margin-left:4px;
    cursor:pointer;box-shadow:0 1px 3px rgba(0,0,0,.2);
  }
  .good{background:#c8e6c9;}
  .bad{background:#ffcdd2;}
  .action{
    display:flex;justify-content:space-around;margin-top:10px;
  }
  .preview{
    background:#f9f9f9;border-radius:10px;
    padding:10px;white-space:pre-wrap;
    box-shadow:inset 0 1px 3px rgba(0,0,0,.1);
  }
</style>
</head>
<body>

<div class="header">
  🦾 QA Inspection Komatsu HD785-7
</div>

<div class="card">
  <label>Jenis Inspeksi:</label>
  <select id="qaType">
    <option value="QA-1">QA-1 Pre Inspection</option>
    <option value="QA-7">QA-7 Final Inspection</option>
  </select>
  <label>📅 Tanggal:</label><input type="text" id="tgl">
  <label>👷 Mekanik:</label><input type="text" id="mekanik">
  <label>🚗 CN Unit:</label><input type="text" id="cn">
  <label>⌛ HM:</label><input type="number" id="hm">
</div>

<div class="card" id="oilLevel">
  <div class="section-title">🩸 Oil Level</div>
  <div id="oilItems"></div>
</div>

<div class="card" id="engineArea">
  <div class="section-title">⚙️ Engine Area</div>
  <div id="engineItems"></div>
</div>

<div class="card" id="cabinArea">
  <div class="section-title">🚗 Cabin Area</div>
  <div id="cabinItems"></div>
</div>

<div class="card" id="frameArea">
  <div class="section-title">🛞 Frame Area</div>
  <div id="frameItems"></div>
</div>

<div class="card">
  <div class="section-title">💧 Pressure Suspension (Panel)</div>
  <div class="item-row">
    <input id="fl" type="text" placeholder="FL">
    <input id="fr" type="text" placeholder="FR">
    <input id="rl" type="text" placeholder="RL">
    <input id="rr" type="text" placeholder="RR">
  </div>
</div>

<div class="card">
  <div class="section-title">🛠️ Tyre Condition</div>
  <div class="item-row">
    <span>Tyre Condition</span>
    <div>
      <button class="btn" onclick="setStatus(this,'GOOD')">✅</button>
      <button class="btn" onclick="setStatus(this,'BAD')">❌</button>
    </div>
  </div>
  <textarea id="tyreNote" placeholder="Tulis temuan jika BAD"></textarea>
</div>

<div class="card" id="validasi">
  <div class="section-title" id="validasiTitle">📝 Validasi & Kelengkapan Checklist Service</div>
  <div id="validasiItems"></div>
</div>

<div class="card">
  <div class="section-title">⚠️ Deviation</div>
  <textarea id="deviation" placeholder="Temuan otomatis muncul di sini" rows="6" readonly></textarea>
</div>

<div class="action">
  <button class="btn" onclick="showPreview()">🧾 Preview</button>
  <button class="btn" onclick="copyText()">📋 Copy</button>
  <button class="btn" onclick="sendWA()">📤 Send WA</button>
</div>

<div class="card preview" id="previewBox"></div>

<script>
const oil = ["Engine oil level","Transmission oil level","Hydraulic oil level"];
const engine = ["Belt tension","Engine oil leakage","Common Rail Connector","Injector Tube"];
const cabin = ["FM Radio","Fatigue Warning","Power Window"];
const frame = ["Operator seat","Hand Rail"];
const validasiList = [
  "Job Card & Cover Checklist","Form Observasi Redo PS",
  "Form QA 1 & QA 7","Form PPM",
  "Form Check List A","Form Check List B","Form Check List C",
  "Form Backlog","Form FUI","Form Repair Order",
  "Form Combine Maintenance","Form Service Activity Report"
];

function buildSection(id, arr){
  const box=document.getElementById(id+"Items");
  arr.forEach(name=>{
    const row=document.createElement("div");
    row.className="item-row";
    row.innerHTML=`<span>${name}</span>
      <div>
        <button class="btn" onclick="setStatus(this,'GOOD')">✅</button>
        <button class="btn" onclick="setStatus(this,'BAD')">❌</button>
      </div>`;
    const note=document.createElement("textarea");
    note.placeholder="Tulis temuan jika BAD";
    note.dataset.name=name;
    note.oninput=collectDeviation;
    box.append(row,note);
  });
}
buildSection("oil",oil);
buildSection("engine",engine);
buildSection("cabin",cabin);
buildSection("frame",frame);

function buildValidasi(){
  const box=document.getElementById("validasiItems");
  box.innerHTML="";
  validasiList.forEach(v=>{
    const r=document.createElement("div");
    r.className="item-row";
    r.innerHTML=`<span>${v}</span>
      <div>
        <button class="btn" onclick="toggleCheck(this,true)">✅</button>
        <button class="btn" onclick="toggleCheck(this,false)">❌</button>
      </div>`;
    box.append(r);
  });
}
buildValidasi();

function toggleCheck(btn,val){
  const sibs=btn.parentElement.querySelectorAll(".btn");
  sibs.forEach(b=>b.classList.remove("good","bad"));
  btn.classList.add(val?"good":"bad");
}

function setStatus(btn,state){
  const area=btn.closest(".item-row");
  const buttons=area.querySelectorAll(".btn");
  buttons.forEach(b=>b.classList.remove("good","bad"));
  btn.classList.add(state==="GOOD"?"good":"bad");
  area.dataset.status=state;
  collectDeviation();
}

function collectDeviation(){
  const notes=document.querySelectorAll("textarea[data-name]");
  const list=[];
  notes.forEach(n=>{
    const status=n.previousElementSibling.dataset.status;
    if(status==="BAD"&&n.value.trim()!==""){list.push("⚠️ "+n.value.trim());}
  });
  const tyre=document.getElementById("tyreNote");
  const tyreStatus=document.querySelector("#tyreNote").previousElementSibling.querySelector(".good")?"GOOD":
                   document.querySelector("#tyreNote").previousElementSibling.querySelector(".bad")?"BAD":"";
  if(tyreStatus==="BAD"&&tyre.value.trim()!==""){list.push("⚠️ "+tyre.value.trim());}
  document.getElementById("deviation").value=list.join("\n");
}

function showPreview(){
  const tgl=document.getElementById("tgl").value;
  const mekanik=document.getElementById("mekanik").value;
  const cn=document.getElementById("cn").value;
  const hm=document.getElementById("hm").value;
  const qa=document.getElementById("qaType").value;
  const header=`${qa} Inspection\n📅 Tgl : ${tgl}\n👷 Mekanik : ${mekanik}\n🚗 CN : ${cn}\n⌛ HM : ${hm}\n\n---\n`;

  function section(title,arr,id){
    let txt=`${title}\n`;
    const areas=document.querySelectorAll(`#${id}Items .item-row`);
    areas.forEach((a,i)=>{
      const st=a.dataset.status?("✅ "+a.dataset.status):"";
      const name=arr[i];
      const note=a.nextElementSibling.value.trim();
      txt+=`- ${name} : ${st}\n`;
      if(note)txt+=`  Temuan : ${note}\n`;
    });
    return txt+"\n---\n";
  }

  let out=header;
  out+=section("🩸 Oil Level",oil,"oil");
  out+=section("⚙️ Engine Area",engine,"engine");
  out+=section("🚗 Cabin Area",cabin,"cabin");
  out+=section("🛞 Frame Area",frame,"frame");

  const fl=flVal.value,fr=frVal.value,rl=rlVal.value,rr=rrVal.value;
  out+=`💧 Pressure Suspension (Panel)\nFL:${fl} | FR:${fr} | RL:${rl} | RR:${rr}\n\n---\n`;

  const tyreStatus=document.querySelector("#tyreNote").previousElementSibling.querySelector(".good")?"✅ GOOD":
                   document.querySelector("#tyreNote").previousElementSibling.querySelector(".bad")?"❌ BAD":"";
  out+=`🛠️ Tyre Condition\nTyre : ${tyreStatus}\n`;
  const tyre=document.getElementById("tyreNote").value.trim();
  if(tyre)out+=`Jika BAD → ${tyre}\n\n---\n`;

  const validasiTitle=(qa==="QA-1")?
    "📝 Validasi & Kelengkapan Checklist Service":"📝 Kelengkapan Pengisian Checklist Service";
  out+=validasiTitle+"\n";
  document.querySelectorAll("#validasiItems .item-row").forEach(r=>{
    const name=r.querySelector("span").textContent;
    const mark=r.querySelector(".good")?"✅":r.querySelector(".bad")?"❌":"";
    out+=`${name} ${mark}\n`;
  });
  out+=`\n---\n⚠️ Deviation :\n${document.getElementById("deviation").value}`;
  document.getElementById("previewBox").innerText=out;
}

function copyText(){
  navigator.clipboard.writeText(document.getElementById("previewBox").innerText);
  alert("✅ Teks berhasil disalin!");
}

function sendWA(){
  const msg=encodeURIComponent(document.getElementById("previewBox").innerText);
  window.open("https://wa.me/?text="+msg,"_blank");
}

const flVal=document.getElementById("fl"),frVal=document.getElementById("fr"),
      rlVal=document.getElementById("rl"),rrVal=document.getElementById("rr");
document.getElementById("qaType").onchange=function(){
  document.getElementById("validasiTitle").innerText=
    this.value==="QA-7"?"📝 Kelengkapan Pengisian Checklist Service":"📝 Validasi & Kelengkapan Checklist Service";
};
</script>
</body>
</html>
