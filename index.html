<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QA Inspection HD785-7</title>
<style>
  body {
    font-family: "Segoe UI", sans-serif;
    margin: 0;
    background: linear-gradient(to bottom right, #e8f5e9, #fffde7);
    color: #222;
  }
  .header {
    background: linear-gradient(90deg, #f5deb3, #a8e6cf);
    color: #2e2e2e;
    text-align: center;
    padding: 12px;
    font-weight: bold;
    border-radius: 0 0 12px 12px;
    box-shadow: 0 2px 6px rgba(0,0,0,.2);
    font-size: 1.1em;
  }
  .container {padding: 10px;max-width:600px;margin:auto;}
  .card {
    background: #fff;
    margin: 10px 0;
    padding: 10px;
    border-radius: 12px;
    box-shadow: 0 3px 6px rgba(0,0,0,.1);
  }
  .section-title {
    font-weight: bold;
    color: #2e7d32;
    margin-bottom: 5px;
  }
  .item-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin: 4px 0;
    flex-wrap: wrap;
  }
  label, span {font-size: 0.9em;}
  input[type="text"], input[type="number"], textarea, select {
    width: 100%;
    padding: 6px;
    border: 1px solid #ccc;
    border-radius: 6px;
    margin: 3px 0;
    font-size: 0.9em;
  }
  textarea {resize: vertical;}
  .btn {
    border: none;
    padding: 6px 10px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.9em;
    box-shadow: 0 1px 3px rgba(0,0,0,.2);
    margin-left: 3px;
  }
  .good {background: #c8e6c9;}
  .bad {background: #ffcdd2;}
  .action {
    display: flex;
    justify-content: space-around;
    margin-top: 12px;
  }
  .action .btn {
    background: #dcedc8;
  }

  /* Popup */
  .popup-bg {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,.5);
    justify-content: center;
    align-items: center;
    z-index: 1000;
  }
  .popup {
    background: #fff;
    border-radius: 12px;
    padding: 15px;
    width: 90%;
    max-width: 500px;
    box-shadow: 0 4px 10px rgba(0,0,0,.3);
    animation: fadeIn .3s ease;
  }
  @keyframes fadeIn {from {opacity: 0; transform: scale(0.95);} to {opacity: 1; transform: scale(1);}}
  .popup-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-weight: bold;
    color: #2e7d32;
    margin-bottom: 10px;
  }
  .popup-content {
    background: #f9f9f9;
    border-radius: 10px;
    padding: 10px;
    white-space: pre-wrap;
    max-height: 400px;
    overflow-y: auto;
    font-size: 0.9em;
  }
  .popup-actions {
    display: flex;
    justify-content: space-around;
    margin-top: 10px;
  }
</style>
</head>
<body>

<div class="header">🦾 QA Inspection Komatsu HD785-7</div>

<div class="container">
  <div class="card">
    <label>Jenis Inspeksi:</label>
    <select id="qaType">
      <option value="QA-1">QA-1 Pre Inspection</option>
      <option value="QA-7">QA-7 Final Inspection</option>
    </select>
    <label>📅 Tanggal:</label><input type="text" id="tgl">
    <label>👷 Mekanik:</label><input type="text" id="mekanik">
    <label>🚗 CN Unit:</label><input type="text" id="cn">
    <label>⌛ HM:</label><input type="number" id="hm">
  </div>

  <div class="card" id="oilLevel"><div class="section-title">🩸 Oil Level</div><div id="oilItems"></div></div>
  <div class="card" id="engineArea"><div class="section-title">⚙️ Engine Area</div><div id="engineItems"></div></div>
  <div class="card" id="cabinArea"><div class="section-title">🚗 Cabin Area</div><div id="cabinItems"></div></div>
  <div class="card" id="frameArea"><div class="section-title">🛞 Frame Area</div><div id="frameItems"></div></div>

  <div class="card">
    <div class="section-title">💧 Pressure Suspension (Panel)</div>
    <div class="item-row">
      <input id="fl" type="text" placeholder="FL">
      <input id="fr" type="text" placeholder="FR">
      <input id="rl" type="text" placeholder="RL">
      <input id="rr" type="text" placeholder="RR">
    </div>
  </div>

  <div class="card">
    <div class="section-title">🛠️ Tyre Condition</div>
    <div class="item-row">
      <span>Tyre Condition</span>
      <div>
        <button class="btn" onclick="setStatus(this,'GOOD')">✅</button>
        <button class="btn" onclick="setStatus(this,'BAD')">❌</button>
      </div>
    </div>
    <textarea id="tyreNote" placeholder="Tulis temuan jika BAD"></textarea>
  </div>

  <div class="card" id="validasi">
    <div class="section-title" id="validasiTitle">📝 Validasi & Kelengkapan Checklist Service</div>
    <div id="validasiItems"></div>
  </div>

  <div class="card">
    <div class="section-title">⚠️ Deviation</div>
    <textarea id="deviation" readonly rows="5"></textarea>
  </div>

  <div class="action">
    <button class="btn" onclick="showPreview()">🧾 Preview</button>
  </div>
</div>

<!-- Popup -->
<div class="popup-bg" id="popupBox">
  <div class="popup">
    <div class="popup-header">
      🧾 Preview Hasil
      <button class="btn bad" onclick="closePopup()">❌ Close</button>
    </div>
    <div class="popup-content" id="previewText"></div>
    <div class="popup-actions">
      <button class="btn" onclick="copyText()">📋 Copy</button>
      <button class="btn" onclick="sendWA()">📤 Send WA</button>
    </div>
  </div>
</div>

<script>
const oil=["Engine oil level","Transmission oil level","Hydraulic oil level"];
const engine=["Belt tension","Engine oil leakage","Common Rail Connector","Injector Tube"];
const cabin=["FM Radio","Fatigue Warning","Power Window"];
const frame=["Operator seat","Hand Rail"];
const validasiList=[
  "Job Card & Cover Checklist","Form Observasi Redo PS","Form QA 1 & QA 7","Form PPM",
  "Form Check List A","Form Check List B","Form Check List C","Form Backlog",
  "Form FUI","Form Repair Order","Form Combine Maintenance","Form Service Activity Report"
];
function buildSection(id,arr){
  const box=document.getElementById(id+"Items");
  arr.forEach(name=>{
    const row=document.createElement("div");
    row.className="item-row";
    row.innerHTML=`<span>${name}</span>
    <div><button class="btn" onclick="setStatus(this,'GOOD')">✅</button>
    <button class="btn" onclick="setStatus(this,'BAD')">❌</button></div>`;
    const note=document.createElement("textarea");
    note.placeholder="Tulis temuan jika BAD";
    note.dataset.name=name;
    note.oninput=collectDeviation;
    box.append(row,note);
  });
}
["oil","engine","cabin","frame"].forEach(s=>buildSection(s,eval(s)));
function buildValidasi(){
  const box=document.getElementById("validasiItems");box.innerHTML="";
  validasiList.forEach(v=>{
    const r=document.createElement("div");
    r.className="item-row";
    r.innerHTML=`<span>${v}</span><div>
      <button class="btn" onclick="toggleCheck(this,true)">✅</button>
      <button class="btn" onclick="toggleCheck(this,false)">❌</button></div>`;
    box.append(r);
  });
}
buildValidasi();
function toggleCheck(btn,val){
  btn.parentElement.querySelectorAll(".btn").forEach(b=>b.classList.remove("good","bad"));
  btn.classList.add(val?"good":"bad");
}
function setStatus(btn,state){
  const area=btn.closest(".item-row");
  area.querySelectorAll(".btn").forEach(b=>b.classList.remove("good","bad"));
  btn.classList.add(state==="GOOD"?"good":"bad");
  area.dataset.status=state;collectDeviation();
}
function collectDeviation(){
  const notes=document.querySelectorAll("textarea[data-name]");
  const list=[];
  notes.forEach(n=>{
    const status=n.previousElementSibling.dataset.status;
    if(status==="BAD"&&n.value.trim()!==""){list.push("⚠️ "+n.value.trim());}
  });
  const tyre=document.getElementById("tyreNote");
  const tyreStatus=tyre.previousElementSibling.querySelector(".good")?"GOOD":
                   tyre.previousElementSibling.querySelector(".bad")?"BAD":"";
  if(tyreStatus==="BAD"&&tyre.value.trim()!==""){list.push("⚠️ "+tyre.value.trim());}
  document.getElementById("deviation").value=list.join("\n");
}
function showPreview(){
  const qa=document.getElementById("qaType").value;
  const head=`${qa} Inspection\n📅 Tgl : ${tgl.value}\n👷 Mekanik : ${mekanik.value}\n🚗 CN : ${cn.value}\n⌛ HM : ${hm.value}\n\n---\n`;
  function sect(title,arr,id){
    let txt=`${title}\n`;
    const areas=document.querySelectorAll(`#${id}Items .item-row`);
    areas.forEach((a,i)=>{
      const st=a.dataset.status?("✅ "+a.dataset.status):"";
      const note=a.nextElementSibling.value.trim();
      txt+=`- ${arr[i]} : ${st}\n`;
      if(note)txt+=`  Temuan : ${note}\n`;
    });
    return txt+"\n---\n";
  }
  let out=head;
  out+=sect("🩸 Oil Level",oil,"oil");
  out+=sect("⚙️ Engine Area",engine,"engine");
  out+=sect("🚗 Cabin Area",cabin,"cabin");
  out+=sect("🛞 Frame Area",frame,"frame");
  out+=`💧 Pressure Suspension (Panel)\nFL:${fl.value} | FR:${fr.value} | RL:${rl.value} | RR:${rr.value}\n\n---\n`;
  const tyre=document.getElementById("tyreNote");
  const tyreStatus=tyre.previousElementSibling.querySelector(".good")?"✅ GOOD":
                   tyre.previousElementSibling.querySelector(".bad")?"❌ BAD":"";
  out+=`🛠️ Tyre Condition\nTyre : ${tyreStatus}\n`;
  if(tyre.value.trim()!=="")out+=`Jika BAD → ${tyre.value.trim()}\n\n---\n`;
  const title=(qa==="QA-1")?"📝 Validasi & Kelengkapan Checklist Service":"📝 Kelengkapan Pengisian Checklist Service";
  out+=title+"\n";
  document.querySelectorAll("#validasiItems .item-row").forEach(r=>{
    const name=r.querySelector("span").textContent;
    const mark=r.querySelector(".good")?"✅":r.querySelector(".bad")?"❌":"";
    out+=`${name} ${mark}\n`;
  });
  out+=`\n---\n⚠️ Deviation :\n${deviation.value}`;
  document.getElementById("previewText").innerText=out;
  document.getElementById("popupBox").style.display="flex";
}
function closePopup(){document.getElementById("popupBox").style.display="none";}
function copyText(){
  navigator.clipboard.writeText(document.getElementById("previewText").innerText);
  alert("✅ Disalin ke clipboard");
}
function sendWA(){
  const msg=encodeURIComponent(document.getElementById("previewText").innerText);
  window.open("https://wa.me/?text="+msg,"_blank");
}
document.getElementById("qaType").onchange=function(){
  document.getElementById("validasiTitle").innerText=(this.value==="QA-7")?
    "📝 Kelengkapan Pengisian Checklist Service":
    "📝 Validasi & Kelengkapan Checklist Service";
};
</script>
</body>
</html>
