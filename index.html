<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QA Inspection Form</title>
<style>
  body {
    font-family: "Segoe UI", sans-serif;
    background: linear-gradient(to bottom right, #dcefcf, #f8f3d4);
    margin: 0;
    padding: 10px;
  }
  .card {
    background: #fff;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    border-radius: 16px;
    padding: 15px;
    margin: 12px 0;
  }
  header {
    background: linear-gradient(90deg, #e6c871, #d3b65c);
    color: #333;
    padding: 14px;
    border-radius: 16px;
    text-align: center;
    font-weight: bold;
    box-shadow: 0 3px 8px rgba(0,0,0,0.2);
  }
  label {
    display: block;
    margin-top: 10px;
    font-weight: 600;
  }
  input[type="text"], input[type="date"], textarea {
    width: 100%;
    border: 1px solid #ccc;
    border-radius: 10px;
    padding: 8px;
    margin-top: 5px;
    font-size: 14px;
  }
  textarea { height: 60px; resize: vertical; }

  .toggle-btn {
    padding: 5px 14px;
    border-radius: 8px;
    border: none;
    margin-right: 5px;
    cursor: pointer;
    font-size: 15px;
  }
  .good { background: #c7f5c4; color: #1b5e20; }
  .bad { background: #ffcdd2; color: #b71c1c; }
  .neutral { background: #f1f1f1; color: #333; }

  .section-title {
    font-weight: bold;
    font-size: 16px;
    margin-top: 8px;
  }

  .flex-row { display: flex; justify-content: space-between; align-items: center; gap: 6px; }
  .btn-row { text-align: center; margin-top: 15px; }
  .btn {
    border: none;
    padding: 10px 15px;
    border-radius: 10px;
    margin: 5px;
    font-size: 15px;
    cursor: pointer;
    box-shadow: 0 2px 6px rgba(0,0,0,0.15);
  }
  .preview { background: #a5d6a7; }
  .copy { background: #fff59d; }
  .send { background: #81d4fa; }
  #previewArea {
    white-space: pre-wrap;
    background: #fafafa;
    border-radius: 12px;
    padding: 10px;
    margin-top: 10px;
    font-family: monospace;
  }
</style>
</head>
<body>
<header>üõ†Ô∏è QA Inspection Form</header>

<div class="card">
  <label>Pilih Jenis QA</label>
  <select id="qaType" onchange="updateQAType()" style="width:100%; padding:8px; border-radius:10px;">
    <option value="QA1">QA-1 Pre Inspection</option>
    <option value="QA7">QA-7 Final Inspection</option>
  </select>
  <label>Tanggal</label><input type="date" id="tgl">
  <label>Nama Mekanik</label><input type="text" id="mekanik">
  <label>CN Unit</label><input type="text" id="cn">
  <label>HM</label><input type="text" id="hm">
</div>

<div id="inspectionArea"></div>

<div class="btn-row">
  <button class="btn preview" onclick="generatePreview()">üßæ Preview</button>
  <button class="btn copy" onclick="copyText()">üìã Copy</button>
  <button class="btn send" onclick="sendWA()">üì§ Send to WA</button>
</div>

<div id="previewArea"></div>

<script>
const sections = {
  "Oil Level": ["Engine oil level","Transmission oil level","Hydraulic oil level"],
  "Engine Area": ["Belt tension","Engine oil leakage","Common Rail Connector","Injector Tube"],
  "Cabin Area": ["FM Radio","Fatigue Warning","Power Window"],
  "Frame Area": ["Operator seat","Hand Rail"],
  "Tyre Condition": ["Tyre"]
};

const validationItems = [
  "Job Card & Cover Checklist","Form Observasi Redo PS","Form QA 1 & QA 7","Form PPM",
  "Form Check List A","Form Check List B","Form Check List C","Form Backlog","Form FUI",
  "Form Repair Order","Form Combine Maintenance","Form Service Activity Report"
];

function createSection(title, items) {
  let html = `<div class='card'><div class='section-title'>${title}</div>`;
  items.forEach(item=>{
    html += `
      <div class="flex-row">
        <span>${item}</span>
        <div>
          <button class="toggle-btn neutral" onclick="toggleStatus(this, '${title}', '${item}', 'GOOD')">‚úÖ</button>
          <button class="toggle-btn neutral" onclick="toggleStatus(this, '${title}', '${item}', 'BAD')">‚ùå</button>
        </div>
      </div>
      <textarea placeholder="Tulis temuan jika ada..." id="${title}_${item.replace(/\s/g,'')}"></textarea>
    `;
  });
  html += `</div>`;
  return html;
}

function createValidationSection(title, items){
  let html = `<div class='card'><div class='section-title'>${title}</div>`;
  items.forEach(item=>{
    html += `
      <div class="flex-row">
        <span>${item}</span>
        <div>
          <button class="toggle-btn neutral" onclick="toggleStatus(this, '${title}', '${item}', '‚úÖ')">‚úÖ</button>
          <button class="toggle-btn neutral" onclick="toggleStatus(this, '${title}', '${item}', '‚ùå')">‚ùå</button>
        </div>
      </div>
    `;
  });
  html += `</div>`;
  return html;
}

function updateQAType(){
  const area = document.getElementById('inspectionArea');
  const qaType = document.getElementById('qaType').value;
  let html = "";
  for(let s in sections) html += createSection(s, sections[s]);
  html += `
  <div class='card'>
    <div class='section-title'>üíß Pressure Suspension (Panel)</div>
    <div class="flex-row">
      <span>FL:</span><input type="text" id="fl" style="width:50px;">
      <span>FR:</span><input type="text" id="fr" style="width:50px;">
      <span>RL:</span><input type="text" id="rl" style="width:50px;">
      <span>RR:</span><input type="text" id="rr" style="width:50px;">
    </div>
  </div>
  `;
  const valTitle = qaType === "QA7" ? "Kelengkapan Pengisian Checklist Service" : "Validasi & Kelengkapan Checklist Service";
  html += createValidationSection(valTitle, validationItems);
  html += `<div class='card'><div class='section-title'>‚ö†Ô∏è Deviation</div><div id='deviationList'></div></div>`;
  area.innerHTML = html;
}
updateQAType();

const deviations = [];

function toggleStatus(btn, section, item, status){
  const group = btn.parentElement.querySelectorAll(".toggle-btn");
  group.forEach(b=>b.className="toggle-btn neutral");
  btn.className = status==='GOOD'||status==='‚úÖ' ? "toggle-btn good" : (status==='BAD'||status==='‚ùå') ? "toggle-btn bad" : "toggle-btn neutral";
}

function collectDeviations(){
  const dev = [];
  document.querySelectorAll("textarea").forEach(t=>{
    if(t.value.trim()!=="") dev.push("‚ö†Ô∏è " + t.value.trim());
  });
  return dev.join("\n");
}

function generatePreview(){
  const qaType = document.getElementById('qaType').value;
  const tgl = document.getElementById('tgl').value;
  const mek = document.getElementById('mekanik').value;
  const cn = document.getElementById('cn').value;
  const hm = document.getElementById('hm').value;
  let result = `üìÖ Tgl : ${tgl}\nüë∑ Mekanik : ${mek}\nüöó CN : ${cn}\n‚åõ HM : ${hm}\n\n---\n`;

  for(let s in sections){
    result += `ü©∏ ${s} ü©∏\n`;
    sections[s].forEach(i=>{
      const textarea = document.getElementById(`${s}_${i.replace(/\s/g,'')}`);
      const dev = textarea.value.trim();
      const good = textarea.previousElementSibling.querySelector(".good");
      const bad = textarea.previousElementSibling.querySelector(".bad");
      let status = good ? "‚úÖ GOOD" : bad ? "‚ùå BAD" : "";
      result += `${i} : ${status}\n`;
      if(dev) result += `Temuan : ${dev}\n`;
    });
    result += `\n---\n`;
  }

  result += `üíß Pressure Suspension (Panel)\nFL : ${fl.value} | FR : ${fr.value} | RL : ${rl.value} | RR : ${rr.value}\n\n---\n`;

  const valTitle = qaType === "QA7" ? "üìù Kelengkapan Pengisian Checklist Service" : "üìù Validasi & Kelengkapan Checklist Service";
  result += valTitle + "\n\n";
  validationItems.forEach(v=>{
    const div = [...document.querySelectorAll(".flex-row")].find(el => el.innerText.includes(v));
    if(div){
      const good = div.querySelector(".good");
      const bad = div.querySelector(".bad");
      result += `${v} ${good?"‚úÖ":bad?"‚ùå":""}\n`;
    }
  });

  const devText = collectDeviations();
  if(devText) result += `\n---\n‚ö†Ô∏è Deviation:\n${devText}\n`;

  document.getElementById('previewArea').innerText = result;
}

function copyText(){
  const txt = document.getElementById('previewArea').innerText;
  navigator.clipboard.writeText(txt);
  alert("‚úÖ Teks hasil sudah disalin!");
}

function sendWA(){
  const txt = encodeURIComponent(document.getElementById('previewArea').innerText);
  window.open(`https://wa.me/?text=${txt}`,'_blank');
}
</script>
</body>
</html>
