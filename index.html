<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Checklist QA1 & QA7 Komatsu HD785-7</title>
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    margin: 0; padding: 10px;
    background: linear-gradient(180deg, #fefbea, #eaf8ef);
    color: #333;
  }
  .header {
    text-align: center;
    background: linear-gradient(90deg, #d1b85f, #6cc070);
    color: white;
    padding: 12px; border-radius: 10px;
    font-weight: bold; font-size: 16px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.25);
  }
  .card {
    background: white; padding: 8px;
    margin-top: 8px; border-radius: 10px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  }
  .section-title {
    font-weight: bold; color: #2d6a4f; margin-bottom: 5px;
  }
  label { font-size: 13px; }
  textarea {
    width: 100%; height: 40px;
    border-radius: 6px; border: 1px solid #ccc;
    margin-top: 4px; font-size: 12px;
  }
  button {
    padding: 5px 8px; margin: 2px;
    border: none; border-radius: 6px; font-size: 13px;
    transition: 0.2s;
  }
  .toggle-btn.active.good { background: #a7e9af; color: #064420; }
  .toggle-btn.active.bad { background: #f8b7b0; color: #7a0404; }
  .small-input {
    width: 100%; padding: 4px;
    border-radius: 5px; border: 1px solid #ccc;
    font-size: 13px;
  }
  .actions { text-align: center; margin-top: 10px; }
  .actions button {
    margin: 3px; background: #f5f5f5;
    border: 1px solid #ccc; border-radius: 8px;
  }
  .actions button:hover { background: #d9f7dc; }
  /* Popup Preview */
  .preview-modal {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.4); display: none;
    justify-content: center; align-items: center; z-index: 999;
  }
  .preview-content {
    background: white; border-radius: 10px; padding: 15px;
    width: 90%; max-height: 80vh; overflow-y: auto;
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
  }
  .preview-buttons {
    text-align: center; margin-top: 10px;
  }
  .preview-buttons button {
    margin: 4px; border-radius: 8px; padding: 6px 10px;
  }
  .close-btn {
    background: #f8d7da; color: #721c24;
    border: none; border-radius: 5px;
    padding: 5px 10px; float: right;
  }
</style>
</head>
<body>

<div class="header">✅ CHECKLIST QA1 & QA7 KOMATSU HD785-7</div>

<div class="card">
  <label>📅 Tanggal:</label>
  <input class="small-input" id="tgl" type="text">
  <label>👷 Mekanik:</label>
  <input class="small-input" id="mekanik" type="text">
  <label>🚗 CN Unit:</label>
  <input class="small-input" id="cn" type="text">
  <label>⌛ HM:</label>
  <input class="small-input" id="hm" type="text">
</div>

<div class="card" style="text-align:center;">
  <button onclick="setChecklist('QA1')" id="btnQA1">QA1</button>
  <button onclick="setChecklist('QA7')" id="btnQA7">QA7</button>
</div>

<div id="form-area"></div>

<div class="actions">
  <button onclick="previewResult()">🧾 Preview</button>
  <button onclick="copyResult()">📋 Copy</button>
  <button onclick="sendWA()">📤 Send WA</button>
</div>

<!-- Popup Modal -->
<div id="previewModal" class="preview-modal">
  <div class="preview-content">
    <button class="close-btn" onclick="closePreview()">❌ Close</button>
    <pre id="previewText"></pre>
    <div class="preview-buttons">
      <button onclick="copyResult()">📋 Copy</button>
      <button onclick="sendWA()">📤 Send WA</button>
    </div>
  </div>
</div>

<script>
const qa1Items = [
  "Job Card & Cover Checklist","Form Observasi Redo PS","Form QA 1 & QA 7",
  "Form PPM","Form Check List A","Form Check List B","Form Check List C",
  "Form Backlog","Form FUI","Form Repair Order","Form Combine Maintenance","Form Service Activity Report"
];
const qa7Items = [
  "Job Card & Cover Checklist","Form QA 1 & QA 7","Form PPM",
  "Form Check List A","Form Check List B","Form Check List C","Form Combine Maintenance"
];

let selectedChecklist = "QA1";
let statusData = {}, validationData = {}, deviationList = [];

document.addEventListener("DOMContentLoaded", ()=>{
  document.getElementById("tgl").value = new Date().toLocaleDateString('en-GB', { day:'2-digit', month:'short', year:'numeric' }).replace(/ /g,'-');
  renderForm();
});

function setChecklist(type){
  selectedChecklist = type;
  document.getElementById("btnQA1").style.background = type==="QA1" ? "#a7e9af" : "";
  document.getElementById("btnQA7").style.background = type==="QA7" ? "#a7e9af" : "";
  renderForm();
}

function renderForm(){
  const area = document.getElementById("form-area");
  area.innerHTML = `
    ${section("🩸 Oil Level", ["Engine oil level","Transmission oil level","Hydraulic oil level"])}
    ${section("⚙️ Engine Area", ["Belt tension","Engine oil leakage","Common Rail Connector","Injector Tube"])}
    ${section("🚗 Cabin Area", ["FM Radio","Fatigue Warning","Power Window"])}
    ${section("🛞 Frame Area", ["Operator seat","Hand Rail"])}
    <div class="card">
      <div class="section-title">💧 Pressure Suspension (Panel)</div>
      FL:<input id="fl" class="small-input" style="width:45px;">
      FR:<input id="fr" class="small-input" style="width:45px;">
      RL:<input id="rl" class="small-input" style="width:45px;">
      RR:<input id="rr" class="small-input" style="width:45px;">
    </div>
    ${section("🛠️ Tyre Condition", ["Tyre Condition"])}
    <div class="card">
      <div class="section-title">📝 ${selectedChecklist==="QA1"?"Validasi & Kelengkapan Checklist Service":"Kelengkapan Pengisian Checklist Service"}</div>
      ${(selectedChecklist==="QA1"?qa1Items:qa7Items).map(makeValidation).join('')}
    </div>
  `;
}

function section(title, items){
  return `
  <div class="card">
    <div class="section-title">${title}</div>
    ${items.map(makeItem).join('')}
  </div>`;
}

function makeItem(name){
  const id = name.replace(/\s+/g,'_');
  return `
  <div>
    <label>${name}</label><br>
    <button class="toggle-btn" onclick="toggleStatus(this,'${name}','GOOD')">✅</button>
    <button class="toggle-btn" onclick="toggleStatus(this,'${name}','BAD')">❌</button>
    <textarea placeholder="Tuliskan temuan jika BAD" id="t_${id}"></textarea>
  </div>`;
}

function makeValidation(name){
  return `
  <div style="display:flex;justify-content:space-between;align-items:center;">
    <label>${name}</label>
    <div>
      <button class="toggle-btn" onclick="toggleValidation(this,'${name}','✅')">✅</button>
      <button class="toggle-btn" onclick="toggleValidation(this,'${name}','❌')">❌</button>
    </div>
  </div>`;
}

function toggleStatus(btn, name, status){
  const btns = btn.parentElement.querySelectorAll('.toggle-btn');
  btns.forEach(b=>b.classList.remove('active','good','bad'));
  btn.classList.add('active',status==="GOOD"?"good":"bad");
  statusData[name] = status;
}

function toggleValidation(btn, name, val){
  const btns = btn.parentElement.querySelectorAll('.toggle-btn');
  btns.forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  validationData[name] = val;
}

function previewResult(){
  deviationList = [];
  document.querySelectorAll('textarea').forEach(t=>{
    if(t.value.trim()) deviationList.push("⚠️ "+t.value.trim());
  });

  const result = `
📅 Tgl : ${tgl.value}
👷 Mekanik : ${mekanik.value}
🚗 CN : ${cn.value}
⌛ HM : ${hm.value}

---

🩸 Oil Level 🩸
${formatSection(["Engine oil level","Transmission oil level","Hydraulic oil level"])}

---

⚙️ Engine Area ⚙️
${formatSection(["Belt tension","Engine oil leakage","Common Rail Connector","Injector Tube"])}

---

🚗 Cabin Area 🚗
${formatSection(["FM Radio","Fatigue Warning","Power Window"])}

---

🛞 Frame Area 🛞
${formatSection(["Operator seat","Hand Rail"])}

---

💧 Pressure Suspension 💧
FL:${fl.value} | FR:${fr.value} | RL:${rl.value} | RR:${rr.value}

---

🛠️ Tyre Condition 🛠️
${formatSection(["Tyre Condition"])}

---

📝 ${selectedChecklist==="QA1"?"Validasi & Kelengkapan Checklist Service":"Kelengkapan Pengisian Checklist Service"}
${Object.entries(validationData).map(([k,v])=>`${k} ${v}`).join("\n")}

---

⚠️ Deviation :
${deviationList.join("\n")}
`;
  document.getElementById("previewText").innerText = result;
  document.getElementById("previewModal").style.display = "flex";
}

function closePreview(){
  document.getElementById("previewModal").style.display = "none";
}

function formatSection(names){
  return names.map(n=>`${n} : ${statusData[n]?"✅ "+statusData[n]:""}`).join("\n");
}

function copyResult(){
  const text = document.getElementById("previewText").innerText;
  navigator.clipboard.writeText(text);
  alert("✅ Teks disalin ke clipboard!");
}

function sendWA(){
  const msg = encodeURIComponent(document.getElementById("previewText").innerText);
  window.open(`https://wa.me/?text=${msg}`,'_blank');
}
</script>
</body>
</html>
